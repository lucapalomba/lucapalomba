class TitleAnimator { constructor() { this.titleElement = document.querySelector('.hero-title'); this.INTRO_ANIMATION_DURATION = 2000; this.STEP_DELAY = 2000; this.TYPEWRITER_SPEED = 50; this.ERASE_SPEED = 30; this.isAnimating = false; this.currentLanguage = document.documentElement.lang || 'en'; this.soundPool = []; this.soundPoolIndex = 0; this.SOUND_POOL_SIZE = 5; this.stepIndex = 0; this.steps = { en: [ { text: "I build things for the web.", highlights: ["things", "web"] }, { text: "I build teams for Companies.", highlights: ["teams", "Companies"] }, { text: "I lead teams for goals.", highlights: ["teams", "goals"] } ], it: [ { text: "Costruisco cose per il web.", highlights: ["cose", "web"] }, { text: "Costruisco team per le aziende.", highlights: ["team", "aziende"] }, { text: "Guido team per gli obiettivi.", highlights: ["Guido", "team", "obiettivi"] } ] }; this.init(); } init() { if (!this.titleElement) return; this.initSoundPool(); this.titleElement.style.cursor = 'pointer'; this.titleElement.addEventListener('click', () => { if (!this.isAnimating) { this.resetAndAnimate(); } }); setTimeout(() => { this.startSequence(); }, this.INTRO_ANIMATION_DURATION); } initSoundPool() { try { for (let i = 0; i < this.SOUND_POOL_SIZE; i++) { const audio = new Audio('sounds/keyboard-click.mp3'); audio.preload = 'auto'; audio.volume = 0.2; this.soundPool.push(audio); } } catch (e) { console.debug('Could not initialize sound pool:', e.message); } } startSequence() { this.stepIndex = 0; this.scheduleNextStep(); } scheduleNextStep() { const currentLangSteps = this.steps[this.currentLanguage] || this.steps['en']; if (this.stepIndex < currentLangSteps.length - 1) { setTimeout(() => { this.transitionToStep(this.stepIndex + 1); }, this.STEP_DELAY); } } transitionToStep(nextIndex) { if (!this.titleElement) return; this.currentLanguage = document.documentElement.lang || 'en'; const currentLangSteps = this.steps[this.currentLanguage] || this.steps['en']; if (nextIndex >= currentLangSteps.length) return; const nextStepConfig = currentLangSteps[nextIndex]; this.eraseText(() => { this.stepIndex = nextIndex; this.typeNewText(nextStepConfig.text, nextStepConfig.highlights, () => { this.scheduleNextStep(); }); }); } resetAndAnimate() { this.currentLanguage = document.documentElement.lang || 'en'; const currentLangSteps = this.steps[this.currentLanguage] || this.steps['en']; const initialText = currentLangSteps[0].text; this.titleElement.textContent = initialText; this.updateContent(this.getTextArray(initialText, currentLangSteps[0].highlights)); this.stepIndex = 0; setTimeout(() => { this.scheduleNextStep(); }, this.INTRO_ANIMATION_DURATION); } eraseText(callback) { this.isAnimating = true; const originalText = this.titleElement.textContent; let position = originalText.length; const eraseInterval = setInterval(() => { position--; this.titleElement.textContent = originalText.substring(0, position); if (originalText[position] !== ' ' && this.soundPool.length > 0) { this.playKeySound(); } if (position === 0) { clearInterval(eraseInterval); callback(); } }, this.ERASE_SPEED); } typeNewText(fullText, highlights, callback) { let position = 0; const textArray = this.getTextArray(fullText, highlights); const typeInterval = setInterval(() => { if (position < textArray.length) { if (textArray[position].char !== ' ' && this.soundPool.length > 0) { this.playKeySound(); } this.updateContent(textArray.slice(0, position + 1)); position++; } else { clearInterval(typeInterval); this.updateContent(textArray); this.isAnimating = false; if (callback) callback(); } }, this.TYPEWRITER_SPEED); } playKeySound() { try { if (this.soundPool.length === 0) return; const sound = this.soundPool[this.soundPoolIndex]; this.soundPoolIndex = (this.soundPoolIndex + 1) % this.soundPool.length; sound.currentTime = 0; sound.volume = 0.2; const playPromise = sound.play(); if (playPromise !== undefined) { playPromise.catch(err => { console.debug('Could not play keyboard sound:', err.message); }); } } catch (e) { console.debug('Error playing keyboard sound:', e.message); } } getTextArray(text, highlights) { const result = []; for (let i = 0; i < text.length; i++) { const char = text[i]; let isHighlighted = false; for (const word of highlights) { const wordIndex = text.indexOf(word); if (wordIndex !== -1 && i >= wordIndex && i < wordIndex + word.length) { isHighlighted = true; break; } } result.push({ char, isHighlighted }); } return result; } updateContent(textArray) { let html = ''; let currentHighlight = false; let buffer = ''; for (let i = 0; i < textArray.length; i++) { const item = textArray[i]; if (item.isHighlighted && !currentHighlight) { if (buffer) { html += buffer; buffer = ''; } html += '<span class="highlight">' + item.char; currentHighlight = true; } else if (!item.isHighlighted && currentHighlight) { html += '</span>' + item.char; currentHighlight = false; } else if (item.isHighlighted && currentHighlight) { html += item.char; } else { buffer += item.char; } } if (buffer) html += buffer; if (currentHighlight) html += '</span>'; this.titleElement.innerHTML = html; } } document.addEventListener('DOMContentLoaded', function () { new TitleAnimator(); });