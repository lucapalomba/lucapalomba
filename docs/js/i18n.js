class I18n { constructor() { this.translations = null; this.currentLang = this.detectLanguage(); this.init(); } detectLanguage() { const browserLang = navigator.language || navigator.userLanguage; return browserLang.toLowerCase().startsWith('it') ? 'it' : 'en'; } async init() { await this.loadLanguage(this.currentLang); } async loadLanguage(lang) { try { const response = await fetch(`translations/${lang}.json`); this.translations = await response.json(); this.translate(); this.updateHtmlLang(); this.logConsoleEasterEgg(); } catch (error) { console.error(`Failed to load ${lang} translations:`, error); } } logConsoleEasterEgg() { const message = this.t('consoleEasterEgg'); if (message && message !== 'consoleEasterEgg') { console.log(`%c${message}`, 'font-size: 14px; font-family: monospace; color: #6e48aa; padding: 10px; border: 2px solid #6e48aa; border-radius: 5px;'); } } updateHtmlLang() { document.documentElement.lang = this.currentLang; } t(key) { const keys = key.split('.'); let value = this.translations; for (const k of keys) { if (value && typeof value === 'object') { value = value[k]; } else { return key; } } return value || key; } translate() { if (!this.translations) return; this.updateMetaTags(); document.querySelectorAll('[data-i18n]').forEach(element => { const key = element.getAttribute('data-i18n'); const translation = this.t(key); if (translation && translation !== key) { element.textContent = translation; } }); document.querySelectorAll('[data-i18n-aria]').forEach(element => { const key = element.getAttribute('data-i18n-aria'); const translation = this.t(key); if (translation && translation !== key) { element.setAttribute('aria-label', translation); } }); this.translateExperiences(); } updateMetaTags() { let page = 'index'; if (document.body.classList.contains('experiences-page')) { page = 'experiences'; } else if (document.body.classList.contains('technologies-page')) { page = 'technologies'; } else if (document.body.classList.contains('contact-page')) { page = 'contact'; } const titleElement = document.querySelector('title'); if (titleElement) { const titleKey = (page === 'index') ? 'title' : 'pageTitle'; titleElement.textContent = this.t(`${page}.${titleKey}`); } const metaDesc = document.querySelector('meta[name="description"]'); if (metaDesc) { metaDesc.setAttribute('content', this.t(`${page}.description`)); } } translateExperiences() { const timeline = document.querySelector('.timeline'); if (!timeline) return; const jobs = this.t('experiences.jobs'); if (!Array.isArray(jobs)) return; const timelineItems = timeline.querySelectorAll('.timeline-item'); timelineItems.forEach((item, index) => { if (jobs[index]) { const job = jobs[index]; const dateEl = item.querySelector('.date'); if (dateEl) dateEl.textContent = job.date; const titleEl = item.querySelector('h3'); if (titleEl) { const titleParts = job.title.split(' â€” '); if (titleParts.length === 2) { const [role, company] = titleParts; titleEl.innerHTML = `${role} <span class="company">@ ${company}</span>`; } else { titleEl.innerHTML = job.title; } } const descriptionList = item.querySelector('.job-description'); if (descriptionList && job.description) { const bullets = job.description .split(/\.\s+/) .filter(text => text.trim().length > 0) .map(text => text.trim() + (text.endsWith('.') ? '' : '.')); descriptionList.innerHTML = bullets .map(bullet => `<li>${bullet}</li>`) .join(''); } const keyProjectEl = item.querySelector('.key-project'); if (job.keyProject) { if (!keyProjectEl) { const kpDiv = document.createElement('div'); kpDiv.className = 'key-project'; kpDiv.innerHTML = `<span class="kp-label">${this.t('experiences.keyProject')}</span> ${job.keyProject}`; const techStack = item.querySelector('.tech-stack'); if (techStack) { techStack.parentNode.insertBefore(kpDiv, techStack); } else { item.querySelector('.timeline-content').appendChild(kpDiv); } } else { keyProjectEl.innerHTML = `<span class="kp-label">${this.t('experiences.keyProject')}</span> ${job.keyProject}`; } } else if (keyProjectEl) { keyProjectEl.remove(); } } }); } async switchLanguage(lang) { this.currentLang = lang; await this.loadLanguage(lang); localStorage.setItem('preferredLanguage', lang); } getCurrentLanguage() { return this.currentLang; } } if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', () => { window.i18n = new I18n(); }); } else { window.i18n = new I18n(); }