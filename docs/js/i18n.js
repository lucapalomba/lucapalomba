class I18n { constructor() { this.translations = null; this.currentLang = this.detectLanguage(); this.init(); } detectLanguage() { const browserLang = navigator.language || navigator.userLanguage; return browserLang.toLowerCase().startsWith('it') ? 'it' : 'en'; } async init() { try { const response = await fetch('translations.json'); this.translations = await response.json(); this.translate(); this.updateHtmlLang(); this.logConsoleEasterEgg(); } catch (error) { console.error('Failed to load translations:', error); } } logConsoleEasterEgg() { const message = this.t('consoleEasterEgg'); if (message && message !== 'consoleEasterEgg') { console.log(`%c${message}`, 'font-size: 14px; font-family: monospace; color: #6e48aa; padding: 10px; border: 2px solid #6e48aa; border-radius: 5px;'); } } updateHtmlLang() { document.documentElement.lang = this.currentLang; } t(key) { const keys = key.split('.'); let value = this.translations[this.currentLang]; for (const k of keys) { if (value && typeof value === 'object') { value = value[k]; } else { return key; } } return value || key; } translate() { if (!this.translations) return; this.updateMetaTags(); document.querySelectorAll('[data-i18n]').forEach(element => { const key = element.getAttribute('data-i18n'); const translation = this.t(key); if (translation && translation !== key) { element.textContent = translation; } }); document.querySelectorAll('[data-i18n-aria]').forEach(element => { const key = element.getAttribute('data-i18n-aria'); const translation = this.t(key); if (translation && translation !== key) { element.setAttribute('aria-label', translation); } }); this.translateExperiences(); } updateMetaTags() { const page = document.body.classList.contains('experiences-page') ? 'experiences' : 'index'; const titleElement = document.querySelector('title'); if (titleElement) { titleElement.textContent = this.t(`${page}.${page === 'experiences' ? 'pageTitle' : 'title'}`); } const metaDesc = document.querySelector('meta[name="description"]'); if (metaDesc) { metaDesc.setAttribute('content', this.t(`${page}.description`)); } } translateExperiences() { const timeline = document.querySelector('.timeline'); if (!timeline) return; const jobs = this.t('experiences.jobs'); if (!Array.isArray(jobs)) return; const timelineItems = timeline.querySelectorAll('.timeline-item'); timelineItems.forEach((item, index) => { if (jobs[index]) { const job = jobs[index]; const dateEl = item.querySelector('.date'); if (dateEl) dateEl.textContent = job.date; const titleEl = item.querySelector('h3'); if (titleEl) titleEl.innerHTML = job.title; const descEl = item.querySelector('p:not(.key-project)'); if (descEl) descEl.innerHTML = job.description; const keyProjectEl = item.querySelector('.key-project'); if (keyProjectEl && job.keyProject) { const labelEl = keyProjectEl.querySelector('.kp-label'); if (labelEl) labelEl.textContent = this.t('experiences.keyProject'); const textNode = Array.from(keyProjectEl.childNodes).find( node => node.nodeType === Node.TEXT_NODE ); if (textNode) { textNode.textContent = ' ' + job.keyProject; } } else if (keyProjectEl && !job.keyProject) { keyProjectEl.remove(); } } }); } switchLanguage(lang) { if (this.translations && this.translations[lang]) { this.currentLang = lang; this.translate(); this.updateHtmlLang(); localStorage.setItem('preferredLanguage', lang); } } getCurrentLanguage() { return this.currentLang; } } if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', () => { window.i18n = new I18n(); }); } else { window.i18n = new I18n(); }